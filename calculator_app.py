# calculator_app.py

import streamlit as st

# --- СТРУКТУРЫ ДАННЫХ И КОНФИГУРАЦИЯ ---
# Это как список всех возможных баночек для наших подсчетов.
# Мы заранее готовим место для каждого продукта.
ALL_PRODUCT_CATEGORIES = [
    "ДК", "КК", "Комбо/Кросс КК", "ЦП", "Смарт", "Кешбек", "ЖКУ", "БС",
    "Инвесткопилка", "БС со Стратегией", "Токенизация", "Накопительный Счет",
    "Вклад", "Детская Кросс", "Стикер Кросс", "Сим-Карта", "Кросс ДК",
    "Селфи ДК", "Селфи КК", "Мобильное Приложение"
]

# Это наша "поваренная книга" с разделами.
# Говорит, какие кнопки показывать в каждом меню.
MENUS = {
    "ДК": [
        "ДК", "Комбо/Кросс КК", "ЦП", "Смарт", "Кешбек", "ЖКУ", "БС",
        "Инвесткопилка", "БС со Стратегией", "Токенизация",
        "Накопительный Счет", "Вклад", "Детская Кросс", "Стикер Кросс",
        "Сим-Карта"
    ],
    "КК": [
        "КК", "ЦП", "Смарт", "Кешбек", "ЖКУ", "БС", "Инвесткопилка",
        "БС со Стратегией", "Токенизация", "Накопительный Счет", "Вклад",
        "Детская Кросс", "Стикер Кросс", "Сим-Карта", "Кросс ДК"
    ],
    "Селфи": [
        "Селфи ДК", "Селфи КК"
    ],
    "МП": [
        "Мобильное Приложение"
    ]
}

# --- СТИЛИЗАЦИЯ (CSS) ---
# Здесь мы "украшаем" наш блокнот: делаем белый фон, красивые кнопки
# со скругленными углами и черным текстом.
def set_styles():
    """Применяет CSS стили для оформления приложения."""
    st.markdown("""
        <style>
            /* Основной фон */
            .main .block-container {
                background-color: #FFFFFF;
            }
            /* Стили для всех кнопок */
            .stButton > button {
                width: 100%; /* Одинаковая ширина */
                height: 50px; /* Одинаковая высота */
                border: 1px solid #CCCCCC; /* Тонкая серая рамка */
                border-radius: 8px; /* Скругленные углы */
                color: #000000; /* Черный цвет текста */
                font-family: 'Calibri', sans-serif; /* Шрифт Calibri */
                font-size: 16px;
                font-weight: normal;
                text-align: center; /* Центрирование текста */
                margin-bottom: 10px; /* Отступ снизу */
            }
            /* Стили для поля ввода */
            .stNumberInput > div > div > input {
                font-family: 'Calibri', sans-serif;
                color: #000000;
            }
            /* Стили для текста отчета */
            .report-text {
                font-family: 'Calibri', sans-serif;
                color: #000000;
                font-size: 18px;
                line-height: 1.6;
            }
            h1, h2, h3 {
                font-family: 'Calibri', sans-serif;
                color: #000000;
            }
        </style>
    """, unsafe_allow_html=True)

# --- УПРАВЛЕНИЕ СОСТОЯНИЕМ ---
# Это "память" нашего блокнота.
def initialize_state():
    """Инициализирует состояние сессии при первом запуске или сбросе."""
    # 'data' - это наши баночки, где мы храним числа. Вначале все по нулям.
    if 'data' not in st.session_state:
        # ИСПРАВЛЕНО: Используем st.session_state.data
        st.session_state.data = {category: 0 for category in ALL_PRODUCT_CATEGORIES}
    # 'view' - запоминает, на какой страничке мы сейчас находимся.
    if 'view' not in st.session_state:
        # ИСПРАВЛЕНО: Используем st.session_state.view
        st.session_state.view = 'main_menu'
    # 'current_product' - запоминает, для какого продукта мы в